const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CXxwv03e.js","./C4nQMaHf.js","./CKiwDKMb.js","./entry.DTm9GmC1.css","./zK5C3jIS.js","./C84EnH34.js"])))=>i.map(i=>d[i]);
import{_ as G,p as X,r as c,L as Y,g as Z,e as ee,h as V,c as r,o as d,a as t,i as te,b as P,j as y,w as R,T as W,t as o,y as T,d as I,J as se,z as J,K as ae,x as oe,I as ne,F as le,m as ie,n as re,l as de}from"./CKiwDKMb.js";import{_ as ue}from"./B28r5yU-.js";import{C as ce}from"./C84EnH34.js";import{u as ve}from"./C4nQMaHf.js";const pe={class:"inventory-container"},me={class:"inventory-card"},fe={class:"stats-section"},ge={class:"stat-box"},he={class:"stat-value"},be={class:"stat-box"},ye={class:"stat-value"},_e={class:"form"},we=["disabled"],ke={key:0},Se={key:1},Ce={key:2},xe={id:"qr-reader",style:{width:"100%","max-width":"400px",margin:"0 auto 20px"}},Ne={key:2,class:"divider"},Ae={class:"input-group"},Ie={class:"input-wrapper"},De=["onKeyup","disabled"],Te={class:"input-group"},Oe={class:"input-wrapper"},Pe=["disabled"],Re={class:"input-group offset-group"},Qe={class:"select-wrapper"},Be=["disabled"],Ee=["disabled"],Ve={key:0},We={key:1},Je={key:0,class:"result-box"},Me={class:"result-header"},$e={class:"result-time"},qe={class:"result-grid"},He={class:"result-item"},Le={class:"item-value"},Ue={class:"result-item"},Fe={class:"item-value"},je={class:"result-item"},ze={class:"item-value"},Ke={class:"result-item"},Ge={class:"item-value"},Xe={class:"result-item"},Ye={class:"item-value"},Ze={class:"result-item"},et={class:"item-value"},tt={class:"result-item"},st={class:"item-value"},at={class:"result-item"},ot={class:"item-value"},nt={class:"result-item"},lt={class:"item-value"},it={class:"result-item total-row"},rt={class:"item-value total-value"},dt={key:0,class:"inventory-list"},ut={class:"list-header"},ct={class:"list-count"},vt={class:"list-container"},pt={class:"item-header"},mt={class:"item-product"},ft={class:"item-time"},gt={class:"item-details"},ht={key:0,class:"dot"},bt={key:1},yt={class:"total-badge"},_t={class:"footer"},wt={__name:"inventory",setup(kt){console.log("📦 Inventory page is loading!");const{user:M}=ve(),$=X().public.firstAdminEmail||"",k=c(!1),_=c(!1),p=c(!1),g=c(!1),h=c(""),v=c(null),S=c(0),C=c(null),u=c(null),m=c([]),D=c(null),w=c(!1);let x=null,N=null;const q=Y(()=>m.value.reduce((s,e)=>s+(e.totalInStock||0),0));Z(async()=>{console.log("📦 Inventory page mounted"),console.log("👤 User:",M.value),console.log("📧 Admin email:",$),console.log("✅ Admin access granted (auth temporarily disabled)"),await L(),k.value||await H(),K()}),ee(()=>{N&&A()});async function H(){try{const{Html5Qrcode:s}=await V(async()=>{const{Html5Qrcode:e}=await import("./CXxwv03e.js");return{Html5Qrcode:e}},__vite__mapDeps([0,1,2,3]),import.meta.url);N=s,console.log("✅ Html5Qrcode library loaded")}catch(s){if(console.error("Error loading Html5Qrcode:",s),typeof window<"u"&&!window.Html5Qrcode){const e=document.createElement("script");e.src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js",e.onload=()=>{N=window.Html5Qrcode,console.log("✅ Html5Qrcode loaded from CDN")},document.head.appendChild(e)}}}async function L(){ce.isNativePlatform()?(console.log("📱 Native platform detected"),k.value=!0,await U()):(console.log("🌐 Web platform detected"),k.value=!1,await F())}async function U(){try{x=(await V(()=>import("./zK5C3jIS.js"),__vite__mapDeps([4,2,3,5]),import.meta.url)).BarcodeScanner;const{supported:e}=await x.isSupported();e&&(_.value=!0,console.log("✅ Capacitor camera available"))}catch(s){console.error("خطا در بارگذاری BarcodeScanner:",s),_.value=!1}}async function F(){try{navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?(_.value=!0,console.log("✅ Web camera API available")):(_.value=!1,console.log("❌ Camera API not supported"))}catch(s){console.error("Error checking web camera:",s),_.value=!1}}async function Q(){if(!N){n("کتابخانه اسکنر در حال بارگذاری است...","info"),setTimeout(()=>Q(),1e3);return}try{w.value=!0,p.value=!0,await re(),setTimeout(async()=>{try{const s=new N("qr-reader"),e={fps:10,qrbox:{width:250,height:250},aspectRatio:1,rememberLastUsedCamera:!0,supportedScanTypes:[0]};await s.start({facingMode:"environment"},e,async i=>{console.log("QR Code detected:",i),h.value=i,await A(s),n("کد QR با موفقیت اسکن شد","success")},i=>{}).catch(i=>{console.error("Error starting scanner:",i),n("خطا در راه‌اندازی دوربین","error"),A(s)}),window.currentScanner=s}catch(s){console.error("Scanner initialization error:",s),n("خطا در راه‌اندازی اسکنر","error"),p.value=!1,w.value=!1}},100)}catch(s){console.error("Scanner error:",s),n("خطا در اسکن QR","error"),p.value=!1,w.value=!1}}async function A(s=null){try{const e=s||window.currentScanner;e&&(await e.stop(),e.clear(),window.currentScanner=null)}catch(e){console.error("Error stopping scanner:",e)}finally{p.value=!1,w.value=!1}}async function j(){if(!k.value){w.value?await A():await Q();return}if(!(!x||p.value))try{p.value=!0;const{camera:s}=await x.requestPermissions();if(s!=="granted"&&s!=="limited"){n("دسترسی به دوربین رد شد","error");return}const e=await x.scan({formats:[]});if(e?.barcodes?.length>0){const i=e.barcodes[0].rawValue||e.barcodes[0].displayValue;h.value=i,n("کد QR با موفقیت اسکن شد","success")}else n("کدی شناسایی نشد","info")}catch(s){n(`خطا در اسکن: ${s.message}`,"error")}finally{p.value=!1}}async function B(){const s=h.value.trim();if(s){if(v.value===null||v.value===""||v.value<0){n("لطفاً تعداد کارتن را وارد کنید","error");return}await z(s)}}async function z(s){try{g.value=!0,n("در حال ثبت در انبار...","info");let e;try{e=JSON.parse(s),console.log("Parsed as JSON:",e)}catch{console.log("Not JSON format, trying pipe-delimited format...");const b=s.split("|");if(b.length>=7)e={product:b[0]||"",blend:b[1]||"",origin:b[2]||"",roastDate:b[3]||"",batchNumber:b[4]||"",packageWeight:b[5]||"",packageAmount:parseInt(b[6])||0},console.log("Parsed pipe-delimited data:",e);else{n("فرمت QR نامعتبر است (نه JSON و نه pipe-delimited)","error");return}}e.cartonCount=Number(v.value),e.offset=S.value;const a=["product","blend","origin","roastDate","batchNumber","packageWeight","packageAmount"].filter(l=>!e[l]);if(a.length>0){n(`فیلدهای ضروری خالی هستند: ${a.join(", ")}`,"error");return}if(!e.cartonCount||e.cartonCount<0){n("تعداد کارتن نامعتبر است","error");return}e.packageAmount=parseInt(e.packageAmount)||0;const f=e.cartonCount*e.packageAmount+(e.offset||0),O=await fetch("/api/sheets/inventory",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sheetName:"real-time inventory",data:{Product:e.product,Blend:e.blend,Origin:e.origin,"Roast-Date":e.roastDate,"Batch-Number":e.batchNumber,"Package-Weight":e.packageWeight,"Package-Amount":e.packageAmount,cartoncount:e.cartonCount,offset:e.offset||0,"total in stock":f,Timestamp:new Date().toISOString()}})});if(O.ok){const l=new Date().toLocaleTimeString("fa-IR",{hour:"2-digit",minute:"2-digit"});u.value={data:e,time:l,totalInStock:f},D.value=l,m.value.unshift({...e,totalInStock:f,time:l}),E(),v.value=null,S.value=0,h.value="",n(`محصول ${e.product} با ${f} عدد در انبار ثبت شد`,"success")}else{const l=await O.text();n(`خطا در ثبت: ${l}`,"error")}}catch(e){console.error("خطا در پردازش:",e);const i=new Date().toLocaleTimeString("fa-IR",{hour:"2-digit",minute:"2-digit"});let a;try{a=JSON.parse(s)}catch{const l=s.split("|");if(l.length>=7)a={product:l[0]||"",blend:l[1]||"",origin:l[2]||"",roastDate:l[3]||"",batchNumber:l[4]||"",packageWeight:l[5]||"",packageAmount:parseInt(l[6])||0};else{n("فرمت داده نامعتبر","error");return}}a.cartonCount=Number(v.value),a.offset=S.value,a.packageAmount=parseInt(a.packageAmount)||0;const f=a.cartonCount*a.packageAmount+(a.offset||0);u.value={data:a,time:i,totalInStock:f},D.value=i,m.value.unshift({...a,totalInStock:f,time:i}),E(),v.value=null,S.value=0,h.value="",n(`محصول با ${f} عدد ثبت شد (حالت آفلاین)`,"info")}finally{g.value=!1}}function n(s,e){C.value={text:s,type:e},setTimeout(()=>{C.value=null},3e3)}function E(){if(typeof window<"u"){const s=new Date().toDateString();localStorage.setItem(`inventory_${s}`,JSON.stringify(m.value))}}function K(){if(typeof window<"u"){const s=new Date().toDateString(),e=localStorage.getItem(`inventory_${s}`);if(e)try{m.value=JSON.parse(e),m.value.length>0&&(D.value=m.value[0].time)}catch(i){console.error("Error loading inventory:",i)}}}return(s,e)=>{const i=ue;return d(),r("div",pe,[t("div",me,[e[36]||(e[36]=te('<div class="header" data-v-d8134770><div class="icon-container" data-v-d8134770><svg viewBox="0 0 24 24" fill="none" data-v-d8134770><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" stroke="currentColor" stroke-width="1.5" data-v-d8134770></path><polyline points="3.27 6.96 12 12.01 20.73 6.96" stroke="currentColor" stroke-width="1.5" data-v-d8134770></polyline><line x1="12" y1="22.08" x2="12" y2="12" stroke="currentColor" stroke-width="1.5" data-v-d8134770></line></svg></div><h1 data-v-d8134770>موجودی انبار</h1><p class="subtitle" data-v-d8134770>ثبت و مدیریت موجودی محصولات</p></div>',1)),P(W,{name:"fade"},{default:R(()=>[C.value?(d(),r("div",{key:0,class:de(["message",`message-${C.value.type}`])},o(C.value.text),3)):y("",!0)]),_:1}),t("div",fe,[t("div",ge,[e[4]||(e[4]=t("span",{class:"stat-label"},"کل محصولات",-1)),t("span",he,o(q.value),1)]),t("div",be,[e[5]||(e[5]=t("span",{class:"stat-label"},"آخرین ثبت",-1)),t("span",ye,o(D.value||"--:--"),1)])]),t("div",_e,[_.value?(d(),r("button",{key:0,onClick:j,disabled:p.value||g.value,class:"btn btn-primary btn-camera"},[e[8]||(e[8]=t("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),t("circle",{cx:"12",cy:"12",r:"3"})],-1)),!p.value&&!g.value?(d(),r("span",ke,"اسکن QR محصول")):p.value?(d(),r("span",Se,e[6]||(e[6]=[t("span",{class:"spinner"},null,-1),I(" در حال اسکن... ",-1)]))):(d(),r("span",Ce,e[7]||(e[7]=[t("span",{class:"spinner"},null,-1),I(" در حال ذخیره... ",-1)])))],8,we)):y("",!0),T(t("div",xe,null,512),[[se,!k.value&&w.value]]),!k.value&&w.value?(d(),r("button",{key:1,onClick:e[0]||(e[0]=a=>A()),class:"btn btn-outline",style:{"margin-bottom":"20px"}},e[9]||(e[9]=[t("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("rect",{x:"4",y:"4",width:"16",height:"16"})],-1),I(" توقف اسکن ",-1)]))):y("",!0),_.value?(d(),r("div",Ne,e[10]||(e[10]=[t("span",null,"یا",-1)]))):y("",!0),t("div",Ae,[e[11]||(e[11]=t("label",{for:"qrcode",class:"label"},"ورود دستی اطلاعات محصول (JSON یا Pipe-delimited)",-1)),t("div",Ie,[T(t("textarea",{id:"qrcode","onUpdate:modelValue":e[1]||(e[1]=a=>h.value=a),placeholder:`JSON: {"product":"Coffee","blend":"Arabica 100%",...}\r
یا\r
Pipe: arabica|40-40-50|bra-col-eth|2025-10-08|25081110001|1 kg|6`,onKeyup:ae(oe(B,["ctrl"]),["enter"]),disabled:g.value,class:"input-field",rows:"4"},null,40,De),[[J,h.value]])]),e[12]||(e[12]=t("small",{class:"input-hint"},"فیلدهای ضروری: product, blend, origin, roastDate, batchNumber, packageWeight, packageAmount",-1))]),t("div",Te,[e[13]||(e[13]=t("label",{for:"cartonCount",class:"label"},"تعداد کارتن",-1)),t("div",Oe,[T(t("input",{id:"cartonCount","onUpdate:modelValue":e[2]||(e[2]=a=>v.value=a),type:"number",min:"0",placeholder:"مثال: 5",disabled:g.value,class:"input-field number-input"},null,8,Pe),[[J,v.value,void 0,{number:!0}]])]),e[14]||(e[14]=t("small",{class:"input-hint"},"تعداد کارتن‌های موجود را وارد کنید (فقط عدد)",-1))]),t("div",Re,[e[17]||(e[17]=t("label",{for:"offset",class:"label"},"تعداد آفست (خارج از کارتن)",-1)),t("div",Qe,[T(t("select",{id:"offset","onUpdate:modelValue":e[3]||(e[3]=a=>S.value=a),class:"select-field",disabled:g.value},e[15]||(e[15]=[t("option",{value:0},"بدون آفست",-1),t("option",{value:1},"1 عدد",-1),t("option",{value:2},"2 عدد",-1),t("option",{value:3},"3 عدد",-1),t("option",{value:4},"4 عدد",-1),t("option",{value:5},"5 عدد",-1)]),8,Be),[[ne,S.value]]),e[16]||(e[16]=t("div",{class:"select-icon"},[t("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M6 9l6 6 6-6"})])],-1))]),e[18]||(e[18]=t("small",{class:"input-hint"},"تعداد بسته‌های خارج از کارتن (حداکثر 5)",-1))]),t("button",{onClick:B,disabled:!h.value||g.value||v.value===null||v.value==="",class:"btn btn-primary"},[g.value?(d(),r("span",We,e[19]||(e[19]=[t("span",{class:"spinner"},null,-1),I(" در حال ذخیره... ",-1)]))):(d(),r("span",Ve,"ثبت در انبار"))],8,Ee)]),P(W,{name:"slide"},{default:R(()=>[u.value?(d(),r("div",Je,[t("div",Me,[e[20]||(e[20]=t("span",{class:"result-label"},"آخرین محصول ثبت شده",-1)),t("span",$e,o(u.value.time),1)]),t("div",qe,[t("div",He,[e[21]||(e[21]=t("span",{class:"item-label"},"محصول:",-1)),t("span",Le,o(u.value.data.product),1)]),t("div",Ue,[e[22]||(e[22]=t("span",{class:"item-label"},"ترکیب:",-1)),t("span",Fe,o(u.value.data.blend),1)]),t("div",je,[e[23]||(e[23]=t("span",{class:"item-label"},"منشأ:",-1)),t("span",ze,o(u.value.data.origin),1)]),t("div",Ke,[e[24]||(e[24]=t("span",{class:"item-label"},"تاریخ رست:",-1)),t("span",Ge,o(u.value.data.roastDate),1)]),t("div",Xe,[e[25]||(e[25]=t("span",{class:"item-label"},"شماره بچ:",-1)),t("span",Ye,o(u.value.data.batchNumber),1)]),t("div",Ze,[e[26]||(e[26]=t("span",{class:"item-label"},"وزن بسته:",-1)),t("span",et,o(u.value.data.packageWeight),1)]),t("div",tt,[e[27]||(e[27]=t("span",{class:"item-label"},"تعداد در کارتن:",-1)),t("span",st,o(u.value.data.packageAmount),1)]),t("div",at,[e[28]||(e[28]=t("span",{class:"item-label"},"تعداد کارتن:",-1)),t("span",ot,o(u.value.data.cartonCount),1)]),t("div",nt,[e[29]||(e[29]=t("span",{class:"item-label"},"آفست:",-1)),t("span",lt,o(u.value.data.offset||0),1)]),t("div",it,[e[30]||(e[30]=t("span",{class:"item-label"},"مجموع در انبار:",-1)),t("span",rt,o(u.value.totalInStock),1)])])])):y("",!0)]),_:1}),m.value.length>0?(d(),r("div",dt,[t("div",ut,[e[31]||(e[31]=t("span",{class:"section-title"},"ثبت‌های امروز",-1)),t("span",ct,o(m.value.length)+" مورد",1)]),t("div",vt,[(d(!0),r(le,null,ie(m.value,(a,f)=>(d(),r("div",{key:f,class:"inventory-item"},[t("div",pt,[t("span",mt,o(a.product)+" - "+o(a.blend),1),t("span",ft,o(a.time),1)]),t("div",gt,[t("span",null,o(a.origin),1),e[32]||(e[32]=t("span",{class:"dot"},"•",-1)),t("span",null,o(a.cartonCount)+" کارتن",1),e[33]||(e[33]=t("span",{class:"dot"},"•",-1)),t("span",null,o(a.packageAmount)+" در کارتن",1),a.offset?(d(),r("span",ht,"•")):y("",!0),a.offset?(d(),r("span",bt,"+"+o(a.offset)+" آفست",1)):y("",!0),e[34]||(e[34]=t("span",{class:"dot"},"•",-1)),t("span",yt,"مجموع: "+o(a.totalInStock),1)])]))),128))])])):y("",!0),t("div",_t,[P(i,{to:"/admin/admin-index",class:"btn btn-outline"},{default:R(()=>e[35]||(e[35]=[t("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M15 18l-6-6 6-6"})],-1),I(" بازگشت به داشبورد ",-1)])),_:1,__:[35]})])])])}}},It=G(wt,[["__scopeId","data-v-d8134770"]]);export{It as default};
