import{_ as V,p as D,r as p,g as A,q as v,c as o,o as i,a,b as E,j as k,d as m,B as f,t as c,w as H,T as U,i as u,l as q}from"./CKiwDKMb.js";import R from"/logo.png";import{u as $}from"./C4nQMaHf.js";const j={class:"dashboard-container"},z={class:"dashboard-card"},F={class:"subtitle"},I={key:0},P={key:0,class:"stats-section"},Q={class:"stat-item"},W={class:"stat-value"},Z={class:"stat-item"},G={class:"stat-value"},J={class:"stat-item"},K={class:"stat-value"},O={class:"footer-actions"},X=["disabled"],Y={key:0},tt={key:1},at={__name:"user-dashboard",setup(st){const{user:e,logout:w,getUserScans:y,isLoading:g}=$(),x=D().public.firstAdminEmail||"",d=p(null),n=p(!1),l=p(null);A(async()=>{console.log("📊 User dashboard mounted"),console.log("👤 User:",e.value),console.log("🔄 AuthLoading:",g.value);let s=0;for(;g.value&&s<20;)await new Promise(t=>setTimeout(t,100)),s++,console.log(`⏳ Waiting for auth... attempt ${s}`);if(console.log("🔍 Final auth state - User:",e.value,"Loading:",g.value),!e.value){console.log("❌ No user found, redirecting to login"),await v("/login");return}if(e.value.email===x){console.log("🔐 Admin detected, redirecting to admin panel"),await v("/admin/admin-index");return}await b()});async function b(){try{const s=await y(100);if(s.success&&s.data){const t=s.data,M=new Date().toDateString(),T=t.filter(h=>new Date(h.scanned_at).toDateString()===M).length,N=t.filter(h=>h.synced_to_sheets).length;d.value={todayScans:T,totalScans:t.length,syncedScans:N}}}catch(s){console.error("Error loading stats:",s)}}const _=()=>{v("/scan")},C=()=>{r("صفحه تاریخچه در حال توسعه است","info")},S=()=>{r("صفحه تنظیمات در حال توسعه است","info")},L=()=>{r('برای اسکن کد، روی دکمه "اسکن بارکد" کلیک کنید. می‌توانید کد را به صورت دستی نیز وارد نمایید.',"info")},B=async()=>{if(!n.value){n.value=!0;try{(await w()).success&&(r("خروج با موفقیت انجام شد","success"),setTimeout(()=>{v("/login")},1e3))}catch(s){console.error("Logout error:",s),r("خطا در خروج از حساب","error")}finally{n.value=!1}}};function r(s,t){l.value={text:s,type:t},setTimeout(()=>{l.value=null},3e3)}return(s,t)=>(i(),o("div",j,[a("div",z,[t[12]||(t[12]=a("div",{class:"logo-container"},[a("img",{src:R,alt:"Never Say No",class:"logo-image"})],-1)),t[13]||(t[13]=a("h1",null,"داشبورد",-1)),a("p",F,[t[0]||(t[0]=m(" خوش آمدید ",-1)),f(e)?(i(),o("span",I,c(f(e).email),1)):k("",!0)]),E(U,{name:"fade"},{default:H(()=>[l.value?(i(),o("div",{key:0,class:q(["message",`message-${l.value.type}`])},c(l.value.text),3)):k("",!0)]),_:1}),a("div",{class:"actions-section"},[a("button",{onClick:_,class:"btn btn-primary"},t[1]||(t[1]=[u('<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-8d7ad644><rect x="3" y="3" width="18" height="18" rx="2" data-v-8d7ad644></rect><line x1="7" y1="7" x2="7" y2="17" data-v-8d7ad644></line><line x1="12" y1="7" x2="12" y2="17" data-v-8d7ad644></line><line x1="17" y1="7" x2="17" y2="17" data-v-8d7ad644></line></svg><span data-v-8d7ad644>اسکن بارکد / QR Code</span>',2)])),a("button",{onClick:C,class:"btn btn-secondary"},t[2]||(t[2]=[a("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[a("circle",{cx:"12",cy:"12",r:"10"}),a("path",{d:"M12 6v6l4 2","stroke-linecap":"round"})],-1),a("span",null,"تاریخچه اسکن‌ها",-1)]))]),d.value?(i(),o("div",P,[a("div",Q,[a("span",W,c(d.value.todayScans||0),1),t[3]||(t[3]=a("span",{class:"stat-label"},"اسکن امروز",-1))]),a("div",Z,[a("span",G,c(d.value.totalScans||0),1),t[4]||(t[4]=a("span",{class:"stat-label"},"کل اسکن‌ها",-1))]),a("div",J,[a("span",K,c(d.value.syncedScans||0),1),t[5]||(t[5]=a("span",{class:"stat-label"},"همگام‌سازی شده",-1))])])):k("",!0),a("div",{class:"quick-links"},[t[9]||(t[9]=a("div",{class:"section-header"},[a("span",{class:"section-title"},"دسترسی سریع")],-1)),a("div",{class:"links-grid"},[t[8]||(t[8]=u('<a href="https://t.me/Torinowholesale_bot?start=w42993986" target="_blank" rel="noopener noreferrer" class="link-card" data-v-8d7ad644><div class="link-icon" data-v-8d7ad644><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-8d7ad644><path d="M22 2L11 13" data-v-8d7ad644></path><path d="M22 2L15 22L11 13L2 9L22 2Z" data-v-8d7ad644></path></svg></div><div class="link-content" data-v-8d7ad644><div class="link-title" data-v-8d7ad644>سفارش تلگرام</div><div class="link-subtitle" data-v-8d7ad644>ثبت سفارش از طریق ربات</div></div><div class="link-arrow" data-v-8d7ad644><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-8d7ad644><path d="M7 17l9.2-9.2M17 17V7H7" data-v-8d7ad644></path></svg></div></a>',1)),a("div",{onClick:L,class:"link-card"},t[6]||(t[6]=[u('<div class="link-icon" data-v-8d7ad644><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-8d7ad644><circle cx="12" cy="12" r="10" data-v-8d7ad644></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" data-v-8d7ad644></path><line x1="12" y1="17" x2="12.01" y2="17" data-v-8d7ad644></line></svg></div><div class="link-content" data-v-8d7ad644><div class="link-title" data-v-8d7ad644>راهنما</div><div class="link-subtitle" data-v-8d7ad644>نحوه استفاده از برنامه</div></div>',2)])),a("div",{onClick:S,class:"link-card"},t[7]||(t[7]=[u('<div class="link-icon" data-v-8d7ad644><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-8d7ad644><circle cx="12" cy="12" r="3" data-v-8d7ad644></circle><path d="M12 1v6m0 6v6m6.66-10.4l-4.24 4.24M9.58 9.58L5.34 5.34m13.32 13.32l-4.24-4.24m-4.84-4.84L5.34 18.66" data-v-8d7ad644></path></svg></div><div class="link-content" data-v-8d7ad644><div class="link-title" data-v-8d7ad644>تنظیمات</div><div class="link-subtitle" data-v-8d7ad644>پروفایل و تنظیمات حساب</div></div>',2)]))])]),a("div",O,[a("button",{onClick:B,disabled:n.value,class:"btn btn-outline btn-logout"},[t[11]||(t[11]=a("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[a("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),a("polyline",{points:"16,17 21,12 16,7"}),a("line",{x1:"21",y1:"12",x2:"9",y2:"12"})],-1)),n.value?(i(),o("span",tt,t[10]||(t[10]=[a("span",{class:"spinner"},null,-1),m(" در حال خروج... ",-1)]))):(i(),o("span",Y,"خروج از حساب"))],8,X)]),t[14]||(t[14]=a("div",{class:"version"}," نسخه 1.0.0 ",-1))])]))}},nt=V(at,[["__scopeId","data-v-8d7ad644"]]);export{nt as default};
